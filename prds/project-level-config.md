# PRD: Project-Level Configuration

## Introduction

William has no concept of project-level configuration. Every time a user creates a workspace for the same project, they re-enter the same defaults (project name, target directory, branch prefix) through the interactive wizard. PRDs generated by `william prd` land in William's own `prds/` directory rather than alongside the project they describe. This feature adds a `.william/` directory with a `config.json` file that stores per-project defaults, a `william init` command to scaffold it interactively, and updated wizard/prd logic to read those defaults automatically.

## Goals

- Eliminate repeated data entry when creating workspaces for the same project
- Make `william prd` output to a project-local directory by default when config exists
- Provide a `william init` command that scaffolds `.william/config.json` interactively
- Preserve full backward compatibility — projects without `.william/` work exactly as today
- Keep the config format consistent with existing conventions (JSON, matching `state.json`)

## User Stories

### US-001: Define config schema and loader

**Description:** As a developer, I need a typed config schema and a function that loads `.william/config.json` from a given directory so that other components can consume project-level defaults.

**Acceptance Criteria:**

- [ ] New file `src/config.ts` exports a `ProjectConfig` interface with fields: `projectName` (string, optional), `branchPrefix` (string, optional), `prdOutput` (string, optional, relative path defaulting to `.william/prds`), `skipDefaults` (boolean, optional, defaults to `false`)
- [ ] Exports `loadProjectConfig(dir: string): ProjectConfig | null` — reads `<dir>/.william/config.json`, returns parsed config or `null` if file doesn't exist
- [ ] Invalid JSON logs a warning to stderr and returns `null` (does not throw)
- [ ] Unknown keys in the JSON are silently ignored (forward compatibility)
- [ ] Typecheck and lint pass

### US-002: `william init` command

**Description:** As a user, I want to run `william init` in my project directory so that a `.william/config.json` is created with my preferred defaults.

**Acceptance Criteria:**

- [ ] New `init` subcommand registered in `src/cli.ts`
- [ ] Prompts for: project name (default: `cwd` basename), branch prefix (default: none), PRD output directory (default: `.william/prds`), and whether to add `.william/` to `.gitignore` (yes/no)
- [ ] Creates `.william/` directory and writes `config.json` with the collected values
- [ ] If user chooses to gitignore, appends `.william/` to the project's `.gitignore` (creates the file if it doesn't exist)
- [ ] If `.william/config.json` already exists, warns and asks to overwrite before proceeding
- [ ] Prints confirmation message with the path to the created config
- [ ] Typecheck and lint pass

### US-003: Wizard reads project config for defaults

**Description:** As a user, I want `william new` to pre-fill wizard prompts from my project config so I don't re-enter the same information every time.

**Acceptance Criteria:**

- [ ] `runNewWizard()` calls `loadProjectConfig(cwd)` at the start
- [ ] When config exists: project name prompt defaults to `config.projectName` (falling back to current behavior if not set)
- [ ] When config exists and `branchPrefix` is set: branch name prompt defaults to `<branchPrefix><workspaceName>` instead of bare workspace name
- [ ] When `config.skipDefaults` is `true`, prompts with config-provided defaults are skipped entirely (their config values are used without asking)
- [ ] When `config.skipDefaults` is `false` or absent, prompts still appear but are pre-filled with config values (user can override)
- [ ] When no config exists, wizard behavior is identical to today
- [ ] Typecheck and lint pass

### US-004: `william prd` outputs to project-local directory

**Description:** As a user, I want PRDs generated by `william prd` to be saved into my project's `.william/prds/` directory when project config exists, so generated PRDs live alongside my project.

**Acceptance Criteria:**

- [ ] When `loadProjectConfig(cwd)` returns a config with `prdOutput` set, use that path (resolved relative to cwd) as the default output directory instead of William's internal `prds/`
- [ ] When config exists but `prdOutput` is not set, default to `.william/prds/` relative to cwd
- [ ] The `-o` / `--output` flag still overrides the config-derived default
- [ ] Output directory is created if it doesn't exist
- [ ] When no config exists, behavior is identical to today (William's internal `prds/` directory)
- [ ] Typecheck and lint pass

### US-005: Documentation updates

**Description:** As a user, I need updated documentation so I know how to use project-level configuration.

**Acceptance Criteria:**

- [ ] `CLAUDE.md` key components table includes `src/config.ts` with role description
- [ ] `docs/architecture.md` mentions `.william/config.json` discovery and its role in the wizard and PRD output
- [ ] Typecheck and lint pass

## Functional Requirements

- FR-1: Config file is `.william/config.json` in the project root, using JSON format
- FR-2: `loadProjectConfig(dir)` looks only in `<dir>/.william/config.json` — no upward directory traversal
- FR-3: Config fields are all optional: `projectName` (string), `branchPrefix` (string), `prdOutput` (string, relative path), `skipDefaults` (boolean)
- FR-4: `william init` interactively scaffolds `.william/config.json` with prompts for each config field
- FR-5: `william init` asks whether to add `.william/` to the project's `.gitignore`
- FR-6: `william init` warns and confirms before overwriting an existing config
- FR-7: The wizard in `william new` reads project config and uses values as prompt defaults
- FR-8: When `skipDefaults` is `true`, the wizard skips prompts that have config-provided values
- FR-9: `william prd` resolves its default output directory from project config when available, falling back to `.william/prds/` when config exists but `prdOutput` is unset
- FR-10: The `-o` / `--output` CLI flag always overrides config-derived PRD output paths
- FR-11: Projects without `.william/` work identically to current behavior — no regressions

## Non-Goals

- No upward directory traversal to find `.william/` in parent directories
- No YAML or TOML config format — JSON only
- No template strings for branch naming (just a simple prefix)
- No migration of existing workspaces to use project config retroactively
- No global/user-level William config (`~/.william/` or similar)
- No validation of `branchPrefix` against git branch naming rules
- `.william/` does not replace or interact with workspace `state.json` — runtime state stays in `workspaces/`

## Technical Considerations

- Config loader should use the same pattern as `loadState()` in `src/prd/tracker.ts` — read JSON, parse, return typed object
- Wizard prompts use Inquirer.js (`@inquirer/prompts`) — the `init` command should follow the same pattern as `runNewWizard()` in `src/wizard.ts`
- The `prdOutput` path is stored relative to the project root but resolved to absolute at usage time via `path.resolve(cwd, config.prdOutput)`
- `WILLIAM_ROOT` (defined in `src/runner.ts`) points to William's install directory and is used for the current default `prds/` path — config-derived paths should be relative to the target project's cwd instead

## Success Metrics

- Running `william new` in a configured project requires zero manual edits to prompted defaults (when `skipDefaults` is true, zero prompts answered)
- `william prd` saves output to the project directory without requiring `-o` flag
- `william init` creates a valid config in under 30 seconds of interaction
- No behavioral change for projects without `.william/`

## Open Questions

- Should `william status` or `william list` surface which project config is active?
- Should `william init` offer to create an initial PRD as part of the scaffolding flow?
